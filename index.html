<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puzzle World</title>

<style>
body {
  background: black;
  color: #16a34a;
  font-family: monospace;
  margin: 0;
  padding: 20px;
}
.panel {
  border: 1px solid #16a34a;
  padding: 16px;
}
.error {
  color: #ff4444;
  border-color: #ff4444;
}
pre {
  white-space: pre-wrap;
  margin: 0;
}
</style>
</head>
<body>

<div id="app"></div>

<script>
/* ---------------- ROUTING ---------------- */
if (!location.hash) location.hash = '#/home';

function getPath() {
  return location.hash.replace('#','') || '/home';
}

/* ---------------- GAME STATE ---------------- */
let inventory = [];
let boulderRemoved = false;

/* ---------------- LOCATIONS ---------------- */
const locations = {

"/home": `
  [ HOME ]
   _______
  |       |
  |  BED  |
  |_______|

You wake up alone.
The world is silent.

There is a way leading /outside
`,

"/home/outside": `
  [ OUTSIDE ]
     â˜ â˜
   ğŸŒ²     ğŸŒ²

Fresh air.
Paths split here.

There is a /farm nearby.
A darker trail leads to a /cave.
`,

"/home/outside/farm": `
  [ FARM ]
   ğŸŒ¾ğŸŒ¾ğŸŒ¾
   ğŸŒ¾ğŸŒ¾ğŸŒ¾

Crops sway gently.

There's a small /hut.
An open /field stretches outward.
`,

"/home/outside/farm/hut": `
  [ HUT ]
   _____
  |_____| 

Dusty and empty.

Something metal catches your eye.
A locked /vault sits here.
`,

"/home/outside/farm/hut/vault": `
  [ VAULT ]
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

A 5-letter lock.
No hints. Just silence.
`,

"/home/outside/farm/hut/vault/CORNY": `
  [ VAULT OPEN ]
  â–ˆ â–¢ â–¢ â–ˆ

Inside:
- medical supplies
- a flashlight

You take the /flashlight.
`,

"/home/outside/farm/field": `
  [ FIELD ]
   ğŸŒ½ğŸŒ½ğŸŒ½
   ğŸŒ½ğŸŒ½ğŸŒ½

A broken /tractor sits idle.
`,

"/home/outside/farm/field/tractor": `
  [ TRACTOR ]
   ______
  |_____|_

A sticky note reads:

"What did the crop say?
Stop being CORNY."
`,

"/home/outside/cave": `
  [ CAVE ]
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  â–ˆ     â–ˆ

Dark.
Too dark to see anything useful.

It feels unwise to continue.
`,

"/home/outside/cave/flashlight": `
  [ CAVE LIT ]
   â–ˆ  ğŸ”¦  â–ˆ

Light reveals paths.

There is a rough /wall.
A deep /hole.
And a narrow /path forward.
`,

"/home/outside/cave/flashlight/path": {
  text: `
  [ NARROW PATH ]
  â–ˆâ–ˆâ–ˆâ–ˆâ›”â–ˆâ–ˆâ–ˆâ–ˆ

A massive boulder blocks the way.
Scratched into stone:

"inspect"
`,
  boulder: true
},

"/thewayforward": `
  [ BEYOND ]
   â–ˆ   â–ˆ

The boulder is gone.

A warning sign reads:
"YOU WERE WARNED"

You may /continue
`,

"/continue": `
  [ END ]
   â–ˆâ–ˆâ–ˆ

You disappear into the dark.

(To be continued)
`
};

/* ---------------- RENDER ---------------- */
function render() {
  const app = document.getElementById('app');
  app.innerHTML = '';

  const path = getPath();
  const loc = locations[path];

  const panel = document.createElement('div');
  panel.className = 'panel';

  if (!loc) {
    panel.classList.add('error');
    panel.innerHTML = `
<pre>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ WRONG PATH   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

"${path}" does not exist.
</pre>`;
    app.appendChild(panel);
    return;
  }

  if (typeof loc === 'string') {
    panel.innerHTML = `<pre>${loc}</pre>`;
  } else {
    panel.innerHTML = `<pre>${loc.text}</pre>`;

    if (loc.boulder && !boulderRemoved) {
      const rock = document.createElement('pre');
      rock.id = 'boulder';
      rock.textContent =
`â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ`;
      panel.appendChild(rock);
    }

    if (loc.boulder && boulderRemoved) {
      panel.innerHTML += `<pre>\nThe path forward is clear.\nYou see /thewayforward</pre>`;
    }
  }

  if (inventory.length) {
    panel.innerHTML += `<pre>\nInventory: ${inventory.join(', ')}</pre>`;
  }

  app.appendChild(panel);
}

/* ---------------- BOULDER INSPECT PUZZLE ---------------- */
new MutationObserver(() => {
  if (!document.getElementById('boulder') && getPath().endsWith('/path')) {
    boulderRemoved = true;
    render();
  }
}).observe(document.body, { childList: true, subtree: true });

/* ---------------- INVENTORY CHECKS ---------------- */
window.addEventListener('hashchange', () => {
  if (getPath().endsWith('/flashlight') && !inventory.includes('flashlight')) {
    location.hash = '#/home/outside/cave';
  }

  if (getPath().endsWith('/vault/CORNY') && !inventory.includes('flashlight')) {
    inventory.push('flashlight');
  }

  render();
});

render();
</script>

</body>
</html>
