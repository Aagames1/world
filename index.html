<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puzzle World</title>

<style>
body {
  background: black;
  color: #16a34a;
  font-family: monospace;
  margin: 0;
  padding: 20px;
}
.panel {
  border: 1px solid #16a34a;
  padding: 16px;
}
pre {
  white-space: pre-wrap;
  margin: 0;
}
.dim {
  color: #4ade80;
}
</style>
</head>
<body>

<div id="app"></div>

<script>
/* ---------- ROUTING ---------- */
if (!location.hash) location.hash = "#/home";
const path = () => location.hash.replace("#","");

/* ---------- GAME STATE ---------- */
let boulderRemoved = false;

/* ---------- LOCATIONS ---------- */
const locations = {

"/home": `
[ HOME ]
 _______
|       |
|  BED  |
|_______|

You wake up alone.

A way leads /outside
`,

"/home/outside": `
[ OUTSIDE ]
 â˜ â˜   ğŸŒ² ğŸŒ²

The air is cold.

Paths:
- /farm
- /cave
`,

"/home/outside/farm": `
[ FARM ]
 ğŸŒ¾ğŸŒ¾ğŸŒ¾
 ğŸŒ¾ğŸŒ¾ğŸŒ¾

There's a /hut.
An open /field.
`,

"/home/outside/farm/hut": `
[ HUT ]
 _____
|_____|

A locked /vault sits inside.
`,

"/home/outside/farm/hut/vault": `
[ VAULT ]
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

5-letter password required.
Try /vault/_____
`,

"/home/outside/farm/hut/vault/CORNY": `
[ VAULT OPEN ]

You find supplies.
A note reads:

"/flashlight"

That might matter elsewhere.
`,

"/home/outside/farm/field": `
[ FIELD ]
 ğŸŒ½ğŸŒ½ğŸŒ½

A rusted /tractor rests here.
`,

"/home/outside/farm/field/tractor": `
[ TRACTOR ]

"What did the crop say?
Stop being CORNY."
`,

"/home/outside/cave": `
[ CAVE ]
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

Too dark to proceed.
Something tells you light matters,
but nothing explicitly says so.
`,

"/home/outside/cave/flashlight": `
[ CAVE LIT ]
 â–ˆ ğŸ”¦ â–ˆ

Light reveals:
- /path
`,

"/home/outside/cave/flashlight/path": {
  text: `
[ NARROW PATH ]
 â–ˆâ–ˆâ–ˆâ–ˆâ›”â–ˆâ–ˆâ–ˆâ–ˆ

A boulder blocks the way.
Carved faintly:

"inspect"
`,
  boulder: true
},

"/home/outside/cave/flashlight/path/thewayforward": `
[ SECURITY GATE ]
 â–ˆ â–ˆ â–ˆ

ACCESS DENIED

Session data appears client-controlled.

Hint:
"Privileges are stored locally."
`,

"/home/outside/cave/flashlight/path/thewayforward/admin": `
[ TERMINAL ]
 =================
 USER: admin
 =================

Database locked.

Query required.
Try appending something...
`,

"/home/outside/cave/flashlight/path/thewayforward/admin?sql=OR1=1": `
[ DATABASE UNLOCKED ]

All restrictions bypassed.

You see one final path:
 /end
`,

"/end": `
[ TRANSMISSION ]

You were never meant to follow paths.
You were meant to question them.

Systems fail.
Curiosity persists.

Thanks for playing.

â€” END â€”
`
};

/* ---------- RENDER ---------- */
function render() {
  const app = document.getElementById("app");
  app.innerHTML = "";

  const loc = locations[path()];
  const panel = document.createElement("div");
  panel.className = "panel";

  if (!loc) {
    panel.innerHTML = `
<pre>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ WRONG PATH   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

"${path()}" does not exist.
</pre>`;
    app.appendChild(panel);
    return;
  }

  if (typeof loc === "string") {
    panel.innerHTML = `<pre>${loc}</pre>`;
  } else {
    panel.innerHTML = `<pre>${loc.text}</pre>`;
    if (loc.boulder && !boulderRemoved) {
      const rock = document.createElement("pre");
      rock.id = "boulder";
      rock.textContent = `
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ`;
      panel.appendChild(rock);
    }
    if (loc.boulder && boulderRemoved) {
      panel.innerHTML += `
<pre class="dim">
The way is open.
You see /thewayforward
</pre>`;
    }
  }

  app.appendChild(panel);
}

/* ---------- BOULDER PUZZLE ---------- */
new MutationObserver(() => {
  if (!document.getElementById("boulder") && path().endsWith("/path")) {
    boulderRemoved = true;
    render();
  }
}).observe(document.body, { childList:true, subtree:true });

/* ---------- COOKIE GATE ---------- */
window.addEventListener("hashchange", () => {
  if (path().endsWith("/thewayforward")) {
    if (!document.cookie.includes("user=admin")) {
      // stay, but locked
    }
  }

  if (path().includes("/admin") && !document.cookie.includes("user=admin")) {
    location.hash = "#/home/outside/cave/flashlight/path/thewayforward";
  }

  render();
});

render();
</script>

</body>
</html>
