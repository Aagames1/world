<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puzzle World</title>

<style>
body {
  background: black;
  color: #16a34a;
  font-family: monospace;
  margin: 0;
  padding: 20px;
}
.panel {
  border: 1px solid #16a34a;
  padding: 16px;
  max-width: 800px;
}
.error {
  color: #ff4444;
  border-color: #ff4444;
}
pre {
  white-space: pre-wrap;
  margin: 0;
}
input {
  background: black;
  color: #16a34a;
  border: 1px solid #16a34a;
  font-family: monospace;
  margin-top: 10px;
  padding: 4px;
}
</style>
</head>
<body>

<div id="app"></div>

<script>
/* ---------------- ROUTING ---------------- */
if (!location.hash) location.hash = '#/home';

function getPath() {
  return location.hash.replace('#','') || '/home';
}

/* ---------------- GAME STATE ---------------- */
let boulderRemoved = false;

/* ---------------- LOCATIONS ---------------- */
const locations = {

"/home": `
[ HOME ]
 _______
|       |
|  BED  |
|_______|

You wake up alone.

There is a way leading /outside
`,

"/home/outside": `
[ OUTSIDE ]
   ğŸŒ²     ğŸŒ²

Fresh air.
Paths split.

There is a /farm nearby.
A darker trail leads to a /cave.
`,

"/home/outside/farm": `
[ FARM ]
 ğŸŒ¾ğŸŒ¾ğŸŒ¾

A small /hut stands here.
An open /field stretches outward.
`,

"/home/outside/farm/hut": `
[ HUT ]
 _____
|_____|

A locked /vault rests inside.
`,

"/home/outside/farm/hut/vault": `
[ VAULT ]
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

A 5-letter lock.

Perhaps the crops know the answer.
`,

"/home/outside/farm/hut/vault/CORNY": `
[ VAULT OPEN ]

Inside, scratched into metal:

"/flashlight obtained.
This could be useful somewhere else."
`,

"/home/outside/farm/field": `
[ FIELD ]
 ğŸŒ½ğŸŒ½ğŸŒ½

A broken /tractor sits idle.
`,

"/home/outside/farm/field/tractor": `
[ TRACTOR ]

A sticky note reads:

"What did the crop say to the other crop?
Stop being CORNY."
`,

"/home/outside/cave": `
[ CAVE ]
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

Too dark to see anything useful.
`,

"/home/outside/cave/flashlight": `
[ CAVE â€” LIT ]

Light reveals three paths:

A rough /wall
A deep /hole
A narrow /path
`,

"/home/outside/cave/flashlight/path": {
  text: `
[ NARROW PATH ]
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

A massive boulder blocks the way.

Scratched into stone:

"inspect"
`,
  boulder: true
},

"/home/outside/cave/flashlight/path/thewayforward": `
[ BEYOND THE BOULDER ]

A warning sign reads:

"YOU WERE WARNED"

There is a /terminal ahead.
`,

"/home/outside/cave/flashlight/path/thewayforward/terminal": {
  text: `
[ TERMINAL ]
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ SECURE LOGIN NODE  â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USERNAME REQUIRED
`,
  requiresSQL: true
},

"/admin": {
  text: `
[ ADMIN PANEL ]

Verifying session...
`,
  requiresCookie: true
}
};

/* ---------------- RENDER ---------------- */
function render() {
  const app = document.getElementById('app');
  app.innerHTML = '';

  const path = getPath();
  const loc = locations[path];

  const panel = document.createElement('div');
  panel.className = 'panel';

  if (!loc) {
    panel.classList.add('error');
    panel.innerHTML = `<pre>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ WRONG PATH   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

"${path}" does not exist.
</pre>`;
    app.appendChild(panel);
    return;
  }

  if (typeof loc === 'string') {
    panel.innerHTML = `<pre>${loc}</pre>`;
  } else {
    panel.innerHTML = `<pre>${loc.text}</pre>`;

    /* BOULDER PUZZLE */
    if (loc.boulder && !boulderRemoved) {
      const rock = document.createElement('pre');
      rock.id = 'boulder';
      rock.textContent =
`â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ`;
      panel.appendChild(rock);
    }

    if (loc.boulder && boulderRemoved) {
      panel.innerHTML += `<pre>

The path forward is clear.

You see /thewayforward
</pre>`;
    }

    /* SQL TERMINAL */
    if (loc.requiresSQL) {
      const input = document.createElement('input');
      input.placeholder = 'username';

      input.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          if (/('|--|or\\s+1=1)/i.test(input.value)) {
            alert('SQL INJECTION DETECTED\nACCESS GRANTED');
            location.hash = '#/admin';
          } else {
            alert('ACCESS DENIED');
          }
        }
      });

      panel.appendChild(input);
    }

    /* COOKIE CHECK */
    if (loc.requiresCookie) {
      if (!document.cookie.includes('user=admin')) {
        panel.classList.add('error');
        panel.innerHTML = `<pre>
ACCESS DENIED

Session data appears client-controlled.
</pre>`;
        app.appendChild(panel);
        return;
      } else {
        panel.innerHTML = `<pre>
ACCESS GRANTED

Welcome, administrator.

SYSTEM UNLOCKED
</pre>`;
      }
    }
  }

  app.appendChild(panel);
}

/* ---------------- BOULDER INSPECT DETECTION ---------------- */
new MutationObserver(() => {
  if (!document.getElementById('boulder') &&
      getPath() === '/home/outside/cave/flashlight/path' &&
      !boulderRemoved) {
    boulderRemoved = true;
    render();
  }
}).observe(document.body, { childList: true, subtree: true });

window.addEventListener('hashchange', render);
render();
</script>

</body>
</html>
