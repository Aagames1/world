<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puzzle World</title>
<style>
body {
  background: black;
  color: #00ffcc;
  font-family: monospace;
  padding: 20px;
  white-space: pre-wrap;
}
.error {
  color: #ff4444;
  border: 2px solid #ff4444;
  padding: 15px;
}
.ascii { color: #66ffcc; }
#blocking-rock {
  border: 2px solid #666;
  padding: 20px;
  margin-top: 10px;
  color: #777;
}
.hidden { display: none; }
</style>
</head>
<body>

<pre id="game"></pre>

<script>
/* ---------- GAME STATE ---------- */
let inventory = [];
let rockRemoved = false;
let sqlBypassed = false;
let adminAccess = false;

/* ---------- HELPERS ---------- */
function getPath() {
  let hash = location.hash.replace("#", "");
  if (!hash) return "/start";
  if (hash.startsWith("/start/")) return hash.replace("/start", "");
  return hash;
}

function setCookie(name, value) {
  document.cookie = `${name}=${value}; path=/`;
}

function getCookie(name) {
  return document.cookie
    .split(";")
    .map(c => c.trim())
    .find(c => c.startsWith(name + "="))
    ?.split("=")[1];
}

/* ---------- LOCATIONS ---------- */
const locations = {
"/start": `
╔════════════════╗
║  PUZZLE WORLD  ║
╚════════════════╝

You stand before a fragmented web of paths.
Somewhere ahead, there’s a /home.
`,

"/home": `
╔════════════╗
║  HOME      ║
╚════════════╝

An empty house.
The front door leads /outside.
`,

"/home/outside": `
╔════════════╗
║  OUTSIDE   ║
╚════════════╝

A silent world stretches out.
There’s a /farm nearby.
A dark /cave waits in the distance.
`,

"/home/outside/farm": `
╔════════════╗
║  FARM      ║
╚════════════╝

Fields of crops sway.
A small /hut stands off to the side.
The land opens into a /field.
`,

"/home/outside/farm/hut": `
╔════════════╗
║  HUT       ║
╚════════════╝

Dusty and abandoned.
Behind a loose plank, something metallic: a /vault.
`,

"/home/outside/farm/hut/vault": `
╔════════════╗
║  VAULT     ║
╚════════════╝

A 5-letter keypad blinks silently.
The lock accepts paths too.
`,

"/home/outside/farm/hut/vault/CORNY": `
╔════════════╗
║  OPENED    ║
╚════════════╝

The vault clicks open.

Inside:
- a FLASHLIGHT
- a note: "<!-- password is ECHO42 -->"

The world beyond the cave no longer feels impossible.
`,

"/home/outside/farm/field": `
╔════════════╗
║  FIELD     ║
╚════════════╝

Rows of crops.
An old /tractor rusts at the edge.
`,

"/home/outside/farm/field/tractor": `
╔════════════╗
║  TRACTOR   ║
╚════════════╝

Under the seat:
"What did the crop say? Stop being CORNY."
`,

"/home/outside/cave": `
╔════════════╗
║  CAVE      ║
╚════════════╝

The cave swallows all light.
Nothing here yields yet.
`,

"/home/outside/cave/flashlight": `
╔════════════╗
║  CAVE      ║
╚════════════╝

Light cuts through darkness.
A narrow /path continues inward.
`,

"/home/outside/cave/flashlight/path": `
╔════════════╗
║  PATH      ║
╚════════════╝

The tunnel tightens.

A massive boulder blocks the way.
Beyond it… something more.
`,

"/home/outside/cave/flashlight/path/beyond": `
╔════════════╗
║  CLEARING  ║
╚════════════╝

The obstruction is gone.

A structure hums ahead.
A /terminal guards the entrance.
`,

"/home/outside/cave/flashlight/path/beyond/terminal": `
╔════════════╗
║ TERMINAL   ║
╚════════════╝

SECURITY LOGIN

Username required.
Some systems trust input too easily.
`,

"/home/outside/cave/flashlight/path/beyond/terminal/lobby": `
╔════════════╗
║  LOBBY     ║
╚════════════╝

Authentication bypassed.

A computer glows quietly.
It leads deeper… toward the /mainframe.

<!-- Developers never clean up comments -->
<!-- Admin password: ECHO42 -->
`,

"/home/outside/cave/flashlight/path/beyond/terminal/mainframe": `
╔════════════╗
║ MAINFRAME  ║
╚════════════╝

ADMIN LOGIN REQUIRED
`,

"/home/outside/cave/flashlight/path/beyond/terminal/mainframe/ECHO42": `
╔════════════╗
║  ACCESS    ║
╚════════════╝

Password accepted.

Files suggest restricted controls in /admin.
But permissions matter.
`,

"/home/outside/cave/flashlight/path/beyond/terminal/mainframe/ECHO42/admin": `
╔════════════╗
║  ADMIN     ║
╚════════════╝

Admin privileges verified.

A final seal lies ahead:
finalchamber?key=VICTORY2025
`,

"/home/outside/cave/flashlight/path/beyond/terminal/mainframe/ECHO42/admin/finalchamber": `
╔════════════╗
║  LOCKED    ║
╚════════════╝

A key parameter is missing.
`
};

/* ---------- RENDER ---------- */
function render() {
  const game = document.getElementById("game");
  const path = getPath();
  const basePath = path.split("?")[0];

  // Flashlight logic
  if (basePath.includes("/cave/flashlight") && !inventory.includes("flashlight")) {
    game.innerHTML = `
╔════════════════════╗
║   ACCESS DENIED    ║
╚════════════════════╝

Darkness blocks your progress.
`;
    game.className = "error";
    return;
  }

  // Boulder logic
  if (basePath === "/home/outside/cave/flashlight/path" && !rockRemoved) {
    game.innerHTML = locations[basePath] + `
<div id="blocking-rock">
████████████████████
█   MASSIVE ROCK   █
████████████████████

Inspect Element required.
</div>
`;
    game.className = "";
    return;
  }

  // SQL injection
  if (basePath.includes("/terminal") && path.toLowerCase().includes("or")) {
    sqlBypassed = true;
    location.hash = "/home/outside/cave/flashlight/path/beyond/terminal/lobby";
    return;
  }

  // Cookie admin
  if (getCookie("userLevel") === "admin") adminAccess = true;

  // Final chamber key
  if (basePath.endsWith("/finalchamber")) {
    if (path.includes("key=VICTORY2025")) {
      game.textContent = `
╔════════════════════════════════╗
║          VICTORY               ║
╚════════════════════════════════╝

You mastered:
- URL navigation
- Inspect Element
- SQL injection
- HTML comments
- Cookies
- Query parameters
`;
      return;
    }
  }

  if (!locations[basePath]) {
    game.innerHTML = `
╔════════════════════╗
║   WRONG PATH       ║
╚════════════════════╝

"${path}" does not exist.
`;
    game.className = "error";
    return;
  }

  game.textContent = locations[basePath];
  game.className = "";

  if (basePath === "/home/outside/farm/hut/vault/CORNY" && !inventory.includes("flashlight")) {
    inventory.push("flashlight");
  }
}

/* ---------- OBSERVE INSPECT ---------- */
const observer = new MutationObserver(() => {
  if (!document.getElementById("blocking-rock") && !rockRemoved) {
    rockRemoved = true;
    location.hash = "/home/outside/cave/flashlight/path/beyond";
  }
});
observer.observe(document.body, { childList: true, subtree: true });

window.addEventListener("hashchange", render);
if (!location.hash) location.hash = "#/start";
render();
</script>

</body>
</html>
