<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puzzle World</title>
<style>
body {
  background: black;
  color: #00ffcc;
  font-family: monospace;
  padding: 20px;
  white-space: pre-wrap;
}
.error {
  color: #ff4444;
  border: 2px solid #ff4444;
  padding: 15px;
}
#blocking-rock {
  border: 2px dashed #555;
  padding: 20px;
  margin-top: 10px;
  color: #777;
}
</style>
</head>
<body>

<pre id="game"></pre>

<script>
/* ========= STATE ========= */
let inventory = [];
let rockRemoved = false;
let adminAccess = false;

/* ========= UTILS ========= */
function getPath() {
  let h = location.hash.replace("#", "");
  if (!h) return "/start";
  if (h.startsWith("/start/")) return h.replace("/start", "");
  return h;
}
function getCookie(name) {
  return document.cookie.split(";").map(c=>c.trim())
    .find(c=>c.startsWith(name+"="))?.split("=")[1];
}

/* ========= WORLD ========= */
const locations = {
"/start": `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ   PUZZLE WORLD   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
     â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—
     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
      â•šâ•â•â•â•â•â•

You stand before a constructed reality.
Somewhere ahead, there is a /home.
`,

"/home": `
â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  HOME    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”›

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ___  â”‚
   â”‚ |___| â”‚
   â”‚       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜

An empty house.
The front door leads /outside.
`,

"/home/outside": `
â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ OUTSIDE  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”›

   ğŸŒ‘   ğŸŒ‘   ğŸŒ‘

A silent world.
Thereâ€™s a /farm nearby.
A dark /cave waits beyond.
`,

"/home/outside/cave": `
â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  CAVE    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”›

   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
   â–ˆ      â–ˆ
   â–ˆ      â–ˆ
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

The cave consumes all light.
Nothing yields yet.
`,

"/home/outside/cave/flashlight": `
â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  CAVE    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”›

   ğŸ”¦â”â”â”â”â”â”â–¶

Light reveals a narrow /path.
`,

"/home/outside/cave/flashlight/path": `
â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  PATH    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”›

The tunnel tightens.

Something massive blocks the way.
It feelsâ€¦ out of place.
`,

"/home/outside/cave/flashlight/path/beyond": `
â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ BEYOND   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”›

   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
   â–‘ CLEAR â–‘
   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘

The obstruction is gone.
A structure hums ahead.
There is a /terminal.
`,

"/home/outside/cave/flashlight/path/beyond/terminal": `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  TERMINAL    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SECURITY LOGIN   â”‚
â”‚ Username: ______ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Some systems trust input too much.
`,

"/home/outside/cave/flashlight/path/beyond/terminal/lobby": `
â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  LOBBY   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”›

Authentication bypassed.

A workstation glows softly.

<!-- Admin password: ECHO42 -->

Deeper systems lie in the /mainframe.
`,

"/home/outside/cave/flashlight/path/beyond/terminal/mainframe": `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ MAINFRAME    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

ADMIN PASSWORD REQUIRED
`,

"/home/outside/cave/flashlight/path/beyond/terminal/mainframe/ECHO42": `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ACCESS OK    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

Password accepted.

Permissions depend on identity.
There is an /admin panel.
`,

"/home/outside/cave/flashlight/path/beyond/terminal/mainframe/ECHO42/admin": `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ADMIN PANEL  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

Privileges confirmed.

Final seal:
finalchamber?key=VICTORY2025
`
};

/* ========= RENDER ========= */
function render() {
  const game = document.getElementById("game");
  const path = getPath();
  const base = path.split("?")[0];

  // flashlight gate
  if (base.includes("/cave/flashlight") && !inventory.includes("flashlight")) {
    game.innerHTML = `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ACCESS DENIEDâ”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

Darkness refuses entry.
`;
    game.className = "error";
    return;
  }

  // boulder puzzle
  if (base === "/home/outside/cave/flashlight/path" && !rockRemoved) {
    game.innerHTML = locations[base] + `
<div id="blocking-rock">
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆ  MASSIVE OBSTRUCTION â–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

It does not feel natural.
</div>
`;
    game.className = "";
    return;
  }

  // SQL injection via URL
  if (base.includes("/terminal") && path.toLowerCase().includes("or")) {
    location.hash = "/home/outside/cave/flashlight/path/beyond/terminal/lobby";
    return;
  }

  // cookie admin
  if (getCookie("userLevel") === "admin") adminAccess = true;

  // final chamber
  if (base.endsWith("/finalchamber")) {
    if (path.includes("key=VICTORY2025")) {
      game.textContent = `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ        VICTORY           â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

You altered the system itself.

You did not play the page.
You broke it.
`;
      return;
    }
  }

  if (!locations[base]) {
    game.innerHTML = `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ WRONG PATH   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

"${path}" does not exist.
`;
    game.className = "error";
    return;
  }

  game.textContent = locations[base];
  game.className = "";

  if (base === "/home/outside/farm/hut/vault/CORNY" && !inventory.includes("flashlight")) {
    inventory.push("flashlight");
  }
}

/* ========= INSPECT DETECTION ========= */
const observer = new MutationObserver(() => {
  if (!document.getElementById("blocking-rock") && !rockRemoved) {
    rockRemoved = true;
    location.hash = "/home/outside/cave/flashlight/path/beyond";
  }
});
observer.observe(document.body, { childList: true, subtree: true });

window.addEventListener("hashchange", render);
if (!location.hash) location.hash = "#/start";
render();
</script>

</body>
</html>
