<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Puzzle World</title>

  <style>
    :root {
      --bg: #000;
      --text: #16a34a;
      --muted: #065f46;
      --accent: #06b6d4;
    }
    html,body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .container { max-width: 720px; width: 100%; }
    .panel { border: 1px solid var(--text); padding: 20px; box-sizing: border-box; }
    .title { color: var(--accent); margin-bottom: 12px; }
    pre { white-space: pre-wrap; margin: 0 0 12px 0; }
    .inventory { margin-top: 12px; color: #a7f3d0; font-size: 12px; }
  </style>
</head>
<body>

<div id="root" class="container"></div>

<script>
// Standalone vanilla JS puzzle world (404 copy for GitHub Pages pathname support)
(function(){
  const isFileProtocol = location.protocol === 'file:';
  // If opened locally (file://), use hash routing and default to /home for a clean start.
  if (isFileProtocol && !location.hash) location.hash = '#/home';
  let path = (isFileProtocol ? (location.hash.slice(1) || '/home') : (window.location.pathname + window.location.search || '/home'));
  let inventory = [];
  let rockHidden = false;
  let sqlBypassUsed = false;
  let adminAccess = false;
  let passwordFound = false;

  const root = document.getElementById('root');

  function getFullPath(){ return isFileProtocol ? (location.hash.slice(1) || '/home') : (window.location.pathname + window.location.search || '/home'); }
  function normalizePath(p){ if (!p.startsWith('/')) p = '/' + p; return p; }
  function getCookieValue(name){ const c = document.cookie.split(';').map(x=>x.trim()).find(x=>x.startsWith(name+'=')); return c ? c.split('=')[1] : null; }
  function victoryText(){ return `CONGRATULATIONS, EXPLORER!\n\nYou've mastered the fundamentals of web security. Type /restart to play again.`; }

  const locations = {
    "/start": `Start:\nwebsitenamepuzzle.com\nStart the puzzle > .com/home\nIntroduce how to explore (add /[location] to the URL)`,

    "/home": `You wake up in your home, only to realize that everyone has seemingly disappeared, and youâ€™re the only one in this seemingly empty world. Head /outside`,

    "/home/outside": `To your left, a /farm, to your right, a /cave`,

    "/home/outside/cave": `Itâ€™s very dark, you donâ€™t think itâ€™s the best idea to explore it.`,

    "/home/outside/farm": `You see a /hut with the door open, and an open /field`,

    "/farm/hut": `Nothing is inside, except a secure /vault.`,
    "/home/outside/farm/hut": `Nothing is inside, except a secure /vault.`,

    "/hut/vault": `A 5 letter lock is protecting it.`,
    "/home/outside/farm/hut/vault": `A 5 letter lock is protecting it.`,

    "/farm/field": `The field is vast, full of crops of wheat and corn. A /tractor is nearby`,
    "/home/outside/farm/field": `The field is vast, full of crops of wheat and corn. A /tractor is nearby`,

    "/field/tractor": `You tried running the tractor, until you realize the engine is missing. You look around the tractor for any clues, and find a sticky note on the bottom.\n\"What did the crop say to the other crop? Stop being CORNY!\"`,
    "/home/outside/farm/field/tractor": `You tried running the tractor, until you realize the engine is missing. You look around the tractor for any clues, and find a sticky note on the bottom.\n\"What did the crop say to the other crop? Stop being CORNY!\"`,

    "/hut/vault/CORNY": `You entered the code, and the vault opened. Inside is some first aid equipment, and a /flashlight.`,
    "/home/outside/farm/hut/vault/CORNY": `You entered the code, and the vault opened. Inside is some first aid equipment, and a /flashlight.`,

    "/cave/flashlight": `You turned the flashlight on and ventured into the cave. A sign reads \"DO NOT TRESPASS\". Thereâ€™s a /wall to your left, a /hole in the middle, and /apath to your right.`,

    "/cave/flashlight/wall": `Itâ€™s /adeadend`,
    "/cave/flashlight/wall/adeadend": `You tried pushing against the wall, but nothing happened.`,

    "/cave/flashlight/hole": `You look down the hole, shining your flashlight, but the end isnâ€™t visible. You try dropping some pebbles of rock down the hole, but you never hear a sound. You could go back, or /jumpdown`,
    "/flashlight/hole": `You look down the hole, shining your flashlight, but the end isnâ€™t visible. You try dropping some pebbles of rock down the hole, but you never hear a sound. You could go back, or /jumpdown`,

    "/hole/jumpdown": `You died. What did you expect?`,

    "/cave/flashlight/apath": `You venture down the narrow path, squeezing between giant rocks and stalagmites. Suddenly, a giant rock is in the way, nothing you do seems to nudge it. You see 'inspect' scrawled on the rock.\n\n[Use Inspect Element to remove the rock and reveal /thewayforward]`,

    "/thewayforward": `As you blink, the rock suddenly disappears. Youâ€™re not sure how it happened or why, but you continue to venture forward. A sign reads \"YOU HAVE BEEN WARNED\"\n/continue`,

    "/continue": `You continue forward and...`,

    "/restart": `Game reset. Go to #/start to play again.`
  };

  function navigateTo(newPath){ newPath = normalizePath(newPath); if (isFileProtocol){ location.hash = newPath; } else { try{ history.replaceState({},'',newPath); }catch(e){} } path = newPath; render(); }

  // Resolve a path to the best matching location key.
  function resolvePath(p){
    if (!p) return {found:false};
    // exact or case-insensitive exact
    if (locations[p]) return { found:true, key:p, loc:locations[p] };
    const lower = p.toLowerCase();
    for (const k of Object.keys(locations)){
      if (k.toLowerCase() === lower) return { found:true, key:k, loc:locations[k] };
    }
    // suffix match: allow /home/outside/cave/flashlight -> match /cave/flashlight
    let best = null;
    for (const k of Object.keys(locations)){
      if (lower.endsWith(k.toLowerCase())){
        if (!best || k.length > best.key.length) best = { key:k, loc:locations[k] };
      }
    }
    if (best) return { found:true, key:best.key, loc:best.loc };
    // prefix fallback: try progressively shorter prefixes
    const parts = p.split('/').filter(Boolean);
    for (let i = parts.length; i >= 0; i--){
      const cand = '/' + parts.slice(0,i).join('/');
      if (locations[cand]) return { found:true, key:cand, loc:locations[cand] };
    }
    return { found:false };
  }

  path = getFullPath() || '/home';
  if (isFileProtocol) {
    window.addEventListener('hashchange', ()=>{ path = getFullPath(); render(); });
  } else {
    window.addEventListener('popstate', ()=>{ path = getFullPath(); render(); });
  }

  setInterval(()=>{ const val = getCookieValue('userLevel'); adminAccess = val === 'admin'; }, 1000);

  (function observeRock(){ const check = () => { if (!document.getElementById('blocking-rock')){ rockHidden = true; } }; const mo = new MutationObserver(check); mo.observe(document.body, { childList:true, subtree:true }); setTimeout(check, 200); })();

  function handleCodeSubmit(val){ if ((val||'').toUpperCase()==='CORNY'){ if (!inventory.includes('flashlight')) inventory.push('flashlight'); alert('Code accepted â€” vault unlocked. Now change the browser URL to /home/outside/farm/hut/vault/CORNY'); } else alert('Wrong code'); }
  function handlePasswordSubmit(val){ if ((val||'').toUpperCase()==='ECHO42'){ passwordFound=true; alert('Password accepted â€” now change the browser URL to /home/outside/cave/flashlight/path/beyond/terminal/mainframe/ECHO42'); } else alert('Wrong password'); }
  function handleSqlAuth(val){ const v=(val||'').trim(); if (/('|--|or\s+1=1)/i.test(v) || v.includes("or '1'='1")){ sqlBypassUsed=true; alert('SQLi detected â€” now change the browser URL to /home/outside/cave/flashlight/path/beyond/terminal/lobby'); } else alert('Login failed'); }

  function render(){
    root.innerHTML = '';
    const header = document.createElement('div'); header.className='panel';
    // Always show a short navigation hint so users know how to change the path
    const info = document.createElement('div'); info.style.marginBottom='8px'; info.style.color='#9ca3af'; info.textContent = 'Change the browser address bar path (e.g. /home) and press Enter to navigate.'; header.appendChild(info);
    const cur=document.createElement('div'); cur.textContent = 'Current path: ' + path; header.appendChild(cur); root.appendChild(header);

    const res = resolvePath(path);
    const notFound = !res.found;
    const raw = res.loc;

    // support two styles: simple string locations or objects with properties
    let titleText = '';
    let contentText = '';
    let isObj = typeof raw === 'object' && raw !== null && !Array.isArray(raw);
    if (typeof raw === 'string'){
      titleText = (res.key === '/start') ? 'Start' : (res.key ? (res.key.split('/').filter(Boolean).pop() || 'Home') : (path.split('/').filter(Boolean).pop() || 'Home'));
      contentText = raw;
    } else if (isObj){
      titleText = raw.title || (res.key ? (res.key.split('/').filter(Boolean).pop() || 'Home') : (path.split('/').filter(Boolean).pop() || 'Home'));
      contentText = typeof raw.content === 'function' ? raw.content(path) : raw.content;
    } else if (notFound){
      titleText = '404';
      contentText = `Path not found: ${path}`;
    }

    if (isObj){ if (raw.givesItem && !inventory.includes(raw.givesItem)) inventory.push(raw.givesItem); if (raw.restart) { inventory=[]; rockHidden=false; sqlBypassUsed=false; adminAccess=false; passwordFound=false; } if (raw.requiresItem && !inventory.includes(raw.requiresItem)){ const box=document.createElement('div'); box.className='panel'; box.innerHTML=`<pre style="color:#f87171">ACCESS DENIED\nYou need ${raw.requiresItem}</pre>`; root.appendChild(box); return; } }

    const main = document.createElement('div'); main.className='panel';
    if (notFound) { main.style.borderColor = '#ff4444'; }
    const title = document.createElement('div'); title.className='title'; title.textContent='> '+titleText; main.appendChild(title);
    const pre = document.createElement('pre'); pre.textContent = contentText; if (notFound) pre.style.color = '#ff4444'; main.appendChild(pre);

    if (isObj && raw.hasInspectPuzzle){
      if (!rockHidden && !document.getElementById('blocking-rock')){
        const rock=document.createElement('div'); rock.id='blocking-rock'; rock.style.border='2px solid #374151'; rock.style.padding='18px'; rock.style.textAlign='center';
        const ascii=document.createElement('pre'); ascii.textContent='    ___________\n   /           \\n  /   MASSIVE   \\n /    BOULDER    \\n/       ðŸª¨        \\n\\                /\n \\\______________/'; rock.appendChild(ascii);
        const hint=document.createElement('div'); hint.textContent='Hint: Inspect element (F12) â†’ delete #blocking-rock'; hint.style.color='#9ca3af'; rock.appendChild(hint);
        const btn=document.createElement('button'); btn.textContent='SIMULATE REMOVE'; btn.style.marginTop='8px'; btn.addEventListener('click', ()=>{ rock.remove(); rockHidden=true; render(); }); rock.appendChild(btn);
        main.appendChild(rock);
      } else if (rockHidden){ const gone=document.createElement('div'); gone.innerHTML=`<pre>THE ROCK HAS VANISHED!\nPath: /home/outside/cave/flashlight/path/beyond</pre>`; const cont=document.createElement('div'); cont.textContent='Now change the browser URL to /home/outside/cave/flashlight/path/beyond to continue.'; gone.appendChild(cont); main.appendChild(gone); }
    }
    if (isObj && raw.requiresAuth){ const box=document.createElement('div'); box.style.marginTop='12px'; box.style.border='1px solid #16a34a'; box.style.padding='12px'; const label=document.createElement('div'); label.textContent='USERNAME (try SQLi)'; box.appendChild(label); const u=document.createElement('input'); u.placeholder='username'; u.addEventListener('keydown',(e)=>{ if (e.key==='Enter') handleSqlAuth(e.target.value); }); const login=document.createElement('button'); login.textContent='LOGIN'; login.addEventListener('click', ()=>handleSqlAuth(u.value)); box.appendChild(u); box.appendChild(login); main.appendChild(box); }

    if (isObj && raw.requiresPassword){ const box=document.createElement('div'); box.style.marginTop='12px'; const p=document.createElement('input'); p.placeholder='password'; p.addEventListener('keydown',(e)=>{ if (e.key==='Enter') handlePasswordSubmit(e.target.value); }); const b=document.createElement('button'); b.textContent='SUBMIT'; b.addEventListener('click', ()=>handlePasswordSubmit(p.value)); box.appendChild(p); box.appendChild(b); main.appendChild(box); }

    if (isObj && raw.requiresCode){ const box=document.createElement('div'); box.style.marginTop='12px'; const c=document.createElement('input'); c.maxLength=5; c.addEventListener('keydown',(e)=>{ if (e.key==='Enter') handleCodeSubmit(c.value); }); const b=document.createElement('button'); b.textContent='SUBMIT'; b.addEventListener('click', ()=>handleCodeSubmit(c.value)); box.appendChild(c); box.appendChild(b); main.appendChild(box); }

    if (path.includes('/settings')){ const box=document.createElement('div'); box.style.marginTop='12px'; const set=document.createElement('button'); set.textContent='SET userLevel=admin'; set.addEventListener('click', ()=>{ document.cookie='userLevel=admin;path=/'; adminAccess=true; alert('cookie set'); render(); }); box.appendChild(set); main.appendChild(box); }

    if (inventory.length) { const inv=document.createElement('div'); inv.className='inventory'; inv.textContent='Inventory: '+inventory.join(', '); main.appendChild(inv); }

    // color current-path display red when invalid
    if (header && header.querySelector) {
      const curEl = header.querySelector('div:nth-child(2)');
      if (curEl) curEl.style.color = notFound ? '#ff4444' : '#9ca3af';
    }

    root.appendChild(main);
  }

  render();

})();

</script>

</body>
</html>
