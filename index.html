<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puzzle World</title>

<style>
body {
  background: black;
  color: #16a34a;
  font-family: monospace;
  margin: 0;
  padding: 20px;
}
.panel {
  border: 1px solid #16a34a;
  padding: 16px;
}
.error {
  color: #ff4444;
  border-color: #ff4444;
}
pre {
  white-space: pre-wrap;
  margin: 0;
}
.notice {
  color: #a7f3d0;
}
</style>
</head>
<body>

<div id="app"></div>

<script>
/* ---------- ROUTING ---------- */
if (!location.hash) location.hash = '#/home';
const getPath = () => location.hash.slice(1) || '/home';

/* ---------- STATE ---------- */
let boulderCleared = false;

/* ---------- LOCATIONS ---------- */
const locations = {

"/home": `
[ HOME ]
 _______
|       |
|  BED  |
|_______|

You wake up alone.

There is a way leading /outside
`,

"/home/outside": `
[ OUTSIDE ]
 ğŸŒ²     ğŸŒ²

The air is still.

There is a /farm nearby.
A darker opening leads to a /cave.
`,

"/home/outside/farm": `
[ FARM ]
 ğŸŒ¾ğŸŒ¾ğŸŒ¾

A /hut sits quietly.
An open /field stretches out.
`,

"/home/outside/farm/hut": `
[ HUT ]
 _____

Dust coats everything.

A locked /vault rests against the wall.
`,

"/home/outside/farm/hut/vault": `
[ VAULT ]
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

A 5-letter lock.
No hints are written.
`,

"/home/outside/farm/hut/vault/CORNY": `
[ VAULT OPEN ]
 â–ˆ â–¢ â–¢ â–ˆ

Inside, scribbled on the inner door:

"/flashlight"

It feels important.
`,

"/home/outside/cave": `
[ CAVE ]
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

It is extremely dark.

You can barely make out shapes.
`,

"/home/outside/cave/flashlight": `
[ CAVE â€” LIT ]
 â–ˆ ğŸ”¦ â–ˆ

The cave opens up.

There is a rough /wall,
a deep /hole,
and a narrow /path.
`,

"/home/outside/cave/flashlight/path": `
[ NARROW PATH ]
 â–ˆâ–ˆâ–ˆâ–ˆâ›”â–ˆâ–ˆâ–ˆâ–ˆ

A massive boulder blocks the way.

Scratched into the stone:
"inspect"
`,

"/thewayforward": `
[ BEYOND ]
 â–ˆ   â–ˆ

The boulder is gone.

A sign reads:
"YOU HAVE BEEN WARNED"

You may /continue
`,

"/continue": `
[ END ]

You step forward.

(To be continued)
`
};

/* ---------- RENDER ---------- */
function render() {
  const app = document.getElementById('app');
  app.innerHTML = '';

  const path = getPath();
  const panel = document.createElement('div');
  panel.className = 'panel';

  if (!locations[path]) {
    panel.classList.add('error');
    panel.innerHTML = `<pre>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ WRONG PATH   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

"${path}" does not exist.
</pre>`;
    app.appendChild(panel);
    return;
  }

  panel.innerHTML = `<pre>${locations[path]}</pre>`;

  // Boulder rendering
  if (path === '/home/outside/cave/flashlight/path' && !boulderCleared) {
    const rock = document.createElement('pre');
    rock.id = 'boulder';
    rock.textContent =
`â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ`;
    panel.appendChild(rock);
  }

  // Reveal after removal
  if (path === '/home/outside/cave/flashlight/path' && boulderCleared) {
    panel.innerHTML += `<pre>

The obstruction is gone.

There is a /thewayforward
</pre>`;
  }

  app.appendChild(panel);
}

/* ---------- BOULDER INSPECT PUZZLE ---------- */
const observer = new MutationObserver(() => {
  if (
    getPath() === '/home/outside/cave/flashlight/path' &&
    !document.getElementById('boulder') &&
    !boulderCleared
  ) {
    boulderCleared = true;
    render();
  }
});
observer.observe(document.body, { childList: true, subtree: true });

/* ---------- HASH CHANGE ---------- */
window.addEventListener('hashchange', render);

/* ---------- INIT ---------- */
render();
</script>

</body>
</html>
