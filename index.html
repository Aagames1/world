<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>World</title>
<style>
  body {
    background: black;
    color: #00ffcc;
    font-family: monospace;
    padding: 20px;
    white-space: pre-wrap;
  }
  .error {
    color: #ff4444;
    border: 2px solid #ff4444;
    padding: 10px;
    margin-top: 10px;
    font-weight: bold;
  }
</style>
</head>
<body>

<pre id="game"></pre>

<script>
const locations = {
  "/start": `
You are standing at the edge of something unfinished.

There’s a worn trail leading toward a /home.
  `,

  "/home": `
You’re inside a quiet house.
It feels abandoned, but not old.

Through the front door, you can head /outside.
  `,

  "/home/outside": `
You step outside the house.

To one side, open land stretches out into a /farm.
On the other, a rocky slope leads down into a /cave.
  `,

  "/home/outside/farm": `
You’re standing at the edge of a farm.

There’s a small /hut near the fence.
Farther out, crops grow unevenly in a wide /field.
  `,

  "/home/outside/farm/hut": `
Inside the hut, dust coats everything.

Behind a loose plank, there’s a hidden /vault.
  `,

  "/home/outside/farm/field": `
The field is quiet.

An old machine sits half-buried here.
Up close, it looks like a /tractor.
  `,

  "/home/outside/farm/field/tractor": `
The tractor hasn’t run in years.

Someone left a note wedged under the seat.
It just says: CORNY
  `,

  "/home/outside/farm/hut/vault/CORNY": `
The vault clicks open.

Inside, you find a flashlight.
Scratched on the inside of the door is a reminder about the /cave.
  `,

  "/home/outside/cave": `
You stand at the cave entrance.

It’s too dark to see far, but with the flashlight,
you might try /flashlight.
  `,

  "/home/outside/cave/flashlight": `
The cave walls come into view.

A narrow /path continues deeper inside.
  `,

  "/home/outside/cave/flashlight/path": `
The path is tight and uneven.

There’s something beyond the rocks here,
almost like there’s more /beyond.
  `,

  "/home/outside/cave/flashlight/path/beyond": `
The passage opens up.

Ahead, there’s a structure that looks like a /terminal.
  `,

  "/home/outside/cave/flashlight/path/beyond/terminal": `
The terminal hums softly.

A nearby door appears to lead to a /lobby.
Another corridor is labeled /mainframe.
  `,

  "/home/outside/cave/flashlight/path/beyond/terminal/mainframe": `
The mainframe door is locked.

A faded label reads: ECHO42
  `,

  "/home/outside/cave/flashlight/path/beyond/terminal/mainframe/ECHO42": `
The door unlocks.

Inside, systems are still running.
You see references to /files and /settings.
  `
};

/* ---------- ROUTING ---------- */
function getPath() {
  let path = location.hash.replace("#", "") || "/start";

  if (path.startsWith("/start/")) {
    path = path.replace("/start", "");
    if (path === "") path = "/home";
  }

  return path;
}

// Longest-prefix match
function resolveLocation(path) {
  const parts = path.split("/").filter(Boolean);
  for (let i = parts.length; i >= 0; i--) {
    const candidate = "/" + parts.slice(0, i).join("/");
    if (locations[candidate]) {
      return candidate;
    }
  }
  return null;
}

function render() {
  const path = getPath();
  const game = document.getElementById("game");

  const resolved = resolveLocation(path);

  if (!resolved) {
    game.innerHTML = `
╔════════════════════════════════════╗
║           WRONG PATH!              ║
╚════════════════════════════════════╝

ERROR: "${path}" does not exist in this world.

Try exploring a valid path like /home or /home/outside.
    `;
    game.classList.add("error");
    return;
  }

  game.textContent = locations[resolved];
  game.classList.remove("error");
}

window.addEventListener("hashchange", render);

if (!location.hash) location.hash = "/start";

render();
</script>

</body>
</html>
