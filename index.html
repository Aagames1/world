<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puzzle World</title>

<style>
body {
  background: black;
  color: #16a34a;
  font-family: monospace;
  margin: 0;
  padding: 20px;
}
.panel {
  border: 1px solid #16a34a;
  padding: 16px;
  max-width: 900px;
}
pre {
  white-space: pre-wrap;
  margin: 0;
}
input, button {
  background: black;
  color: #16a34a;
  border: 1px solid #16a34a;
  font-family: monospace;
  padding: 4px;
}
button { cursor: pointer; }
</style>
</head>
<body>

<div id="app"></div>

<script>
/* ---------- ROUTING ---------- */
if (!location.hash) location.hash = '#/home';
const getPath = () => location.hash.slice(1) || '/home';

/* ---------- BOULDER STATE ---------- */
let boulderEverRendered = false;
let boulderRemoved = false;
let rendering = false;

/* ---------- LOCATIONS ---------- */
const locations = {

"/home": `
[ HOME ]
 _______
|       |
|  BED  |
|_______|

You wake up alone.

A way leads /outside
`,

"/home/outside": `
[ OUTSIDE ]

Wind moves through trees.

To the left, a /farm.
To the right, a dark /cave.
`,

"/home/outside/farm": `
[ FARM ]
  üåæüåæüåæ

There is a /hut.
A wide /field stretches on.
`,

"/home/outside/farm/field": `
[ FIELD ]

An old /tractor sits rusting.
`,

"/home/outside/farm/field/tractor": `
[ TRACTOR ]

A taped note reads:

"What did the crop say to the other crop?
Stop being CORNY."
`,

"/home/outside/farm/hut": `
[ HUT ]

Dust hangs in the air.

A locked /vault is here.
`,

"/home/outside/farm/hut/vault": `
[ VAULT ]

A 5-letter lock.
/vault/?????
`,

"/home/outside/farm/hut/vault/CORNY": `
[ VAULT OPEN ]

Inside is a folded note:

"/FLASHLIGHT"

This could be useful somewhere else.
`,

"/home/outside/cave": `
[ CAVE ]

Darkness presses in.

You can't see anything useful.
`,

"/home/outside/cave/flashlight": `
[ CAVE ‚Äî LIT ]

Light reveals rough stone.

There is a narrow /path.
A cracked /wall.
A deep /hole.
`,

"/home/outside/cave/flashlight/path": {
  text: `
[ NARROW PATH ]

A massive boulder blocks the way.

Scratched into the stone:

"inspect"
`,
  boulder: true
},

"/home/outside/cave/flashlight/path/thewayforward": `
[ BEYOND ]

The boulder is gone.

A sign reads:
"YOU WERE WARNED"

You may /continue
`,

"/home/outside/cave/flashlight/path/thewayforward/continue": {
  text: `
[ TERMINAL ]
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ ACCESS   ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

A dusty terminal hums.

> LOGIN REQUIRED
`,
  terminal: true
},

"/home/outside/cave/flashlight/path/thewayforward/continue/root": {
  text: `
[ ROOT ACCESS ]

Welcome, administrator.

SYSTEM UNLOCKED.
`,
  cookieGate: true
},

"/home/outside/cave/flashlight/path/thewayforward/continue/root/end": `
[ END ]

The screen fades to black.

You were never meant to escape ‚Äî
only to understand the system.

Thanks for playing.
`
};

/* ---------- RENDER ---------- */
function render() {
  rendering = true;

  const app = document.getElementById('app');
  app.innerHTML = '';

  const p = getPath();
  const loc = locations[p];

  const panel = document.createElement('div');
  panel.className = 'panel';

  if (!loc) {
    panel.innerHTML = `<pre>
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ WRONG PATH   ‚îÉ
‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ

"${p}" does not exist.
</pre>`;
    app.appendChild(panel);
    rendering = false;
    return;
  }

  if (typeof loc === 'string') {
    panel.innerHTML = `<pre>${loc}</pre>`;
  } else {
    panel.innerHTML = `<pre>${loc.text}</pre>`;

    /* BOULDER */
    if (loc.boulder) {
      if (!boulderRemoved) {
        const rock = document.createElement('pre');
        rock.id = 'boulder';
        rock.textContent =
`‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà`;
        panel.appendChild(rock);
        boulderEverRendered = true;
      } else {
        panel.innerHTML += `<pre>
The path is clear.
Proceed to /thewayforward
</pre>`;
      }
    }

    /* TERMINAL */
    if (loc.terminal) {
      const input = document.createElement('input');
      input.placeholder = 'username';

      const btn = document.createElement('button');
      btn.textContent = 'LOGIN';

      btn.onclick = () => handleTerminal(input.value);
      input.onkeydown = e => e.key === 'Enter' && handleTerminal(input.value);

      panel.appendChild(input);
      panel.appendChild(btn);
    }

    /* COOKIE GATE */
    if (loc.cookieGate) {
      if (document.cookie.includes('access=granted')) {
        panel.innerHTML += `<pre>
Session verified.

Proceed to /end
</pre>`;
      } else {
        panel.innerHTML += `<pre>
Session data appears client-controlled.
</pre>`;
      }
    }
  }

  app.appendChild(panel);
  rendering = false;
}

/* ---------- BOULDER OBSERVER ---------- */
const observer = new MutationObserver(() => {
  if (rendering) return;

  if (
    boulderEverRendered &&
    !document.getElementById('boulder') &&
    getPath().endsWith('/path')
  ) {
    boulderRemoved = true;
    render();
  }
});

observer.observe(document.body, { childList: true, subtree: true });

/* ---------- TERMINAL ---------- */
function handleTerminal(val) {
  const v = val.toLowerCase();
  if (v.includes("'") || v.includes("or 1=1")) {
    document.cookie = "access=granted; path=/";
    location.hash =
      '#/home/outside/cave/flashlight/path/thewayforward/continue/root';
  } else {
    alert('ACCESS DENIED');
  }
}

/* ---------- LISTEN ---------- */
window.addEventListener('hashchange', render);
render();
</script>

</body>
</html>
