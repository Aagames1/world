<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puzzle World</title>

<style>
body {
  background: black;
  color: #16a34a;
  font-family: monospace;
  margin: 0;
  padding: 20px;
}
.panel {
  border: 1px solid #16a34a;
  padding: 16px;
}
pre {
  white-space: pre-wrap;
  margin: 0;
}
</style>
</head>
<body>

<div id="app"></div>

<script>
/* ---------- ROUTING ---------- */
if (!location.hash) location.hash = "#/home";
const path = () => location.hash.replace("#","") || "/home";

/* ---------- STATE ---------- */
let inventory = [];
let boulderRemoved = false;

/* ---------- LOCATIONS ---------- */
const locations = {

"/home": `
  [ HOME ]
   _______
  |       |
  |  BED  |
  |_______|

You wake up alone.

A way leads /outside
`,

"/home/outside": `
  [ OUTSIDE ]
   ğŸŒ²   ğŸŒ²

Paths split.

There's a quiet /farm.
A darker /cave beyond.
`,

"/home/outside/farm": `
  [ FARM ]
   ğŸŒ¾ğŸŒ¾ğŸŒ¾

A small /hut sits nearby.
An open /field stretches out.
`,

"/home/outside/farm/hut": `
  [ HUT ]
   _____
  |_____| 

A locked /vault rests here.
`,

"/home/outside/farm/hut/vault": `
  [ VAULT ]
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

A 5-letter password:
/vault/?????
`,

"/home/outside/farm/hut/vault/CORNY": `
  [ VAULT OPEN ]
  â–ˆ â–¢ â–¢ â–ˆ

Inside:
A note labeled "/flashlight"

This could be useful somewhere else.
`,

"/home/outside/farm/field": `
  [ FIELD ]
   ğŸŒ½ğŸŒ½ğŸŒ½

A broken /tractor sits idle.
`,

"/home/outside/farm/field/tractor": `
"What did the crop say to the other crop?
Stop being CORNY."
`,

"/home/outside/cave": `
  [ CAVE ]
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

Dark.
Unwise to continue.
`,

"/home/outside/cave/flashlight": `
  [ CAVE LIT ]
   â–ˆ ğŸ”¦ â–ˆ

Light reveals:
A narrow /path forward.
`,

"/home/outside/cave/flashlight/path": {
  text: `
  [ PATH ]
  â–ˆâ–ˆâ–ˆâ›”â–ˆâ–ˆâ–ˆ

A massive boulder blocks the way.
Scratched into the stone:

"inspect"
`,
  boulder: true
},

"/home/outside/cave/flashlight/path/thewayforward": `
  [ BEYOND ]
   â–ˆ   â–ˆ

A terminal hums faintly.

/terminal
`,

"/home/outside/cave/flashlight/path/thewayforward/terminal": `
  [ TERMINAL ]

LOGIN REQUIRED

Username:
`,
"/admin": `
  ACCESS DENIED

Session data appears client-controlled.
`,

"/end": `
  [ EXIT ]
   â–ˆâ–ˆâ–ˆ

You reach the core.

The system shuts down.

Thank you for playing.
`
};

/* ---------- RENDER ---------- */
function render() {
  const app = document.getElementById("app");
  app.innerHTML = "";
  const p = path();
  const loc = locations[p];

  const panel = document.createElement("div");
  panel.className = "panel";

  if (!loc) {
    panel.innerHTML = `<pre>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ WRONG PATH   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

"${p}" does not exist.
</pre>`;
    app.appendChild(panel);
    return;
  }

  if (typeof loc === "string") {
    panel.innerHTML = `<pre>${loc}</pre>`;
  } else {
    panel.innerHTML = `<pre>${loc.text}</pre>`;
    if (loc.boulder && !boulderRemoved) {
      const rock = document.createElement("pre");
      rock.id = "boulder";
      rock.textContent =
`â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ`;
      panel.appendChild(rock);
    }
  }

  app.appendChild(panel);
}

/* ---------- BOULDER INSPECT PUZZLE ---------- */
new MutationObserver(() => {
  if (
    !document.getElementById("boulder") &&
    path().endsWith("/path") &&
    !boulderRemoved
  ) {
    boulderRemoved = true;
    const note = document.createElement("pre");
    note.textContent = `
The obstruction is gone.

Faint text appears:
/thewayforward
`;
    document.querySelector(".panel").appendChild(note);
  }
}).observe(document.body, { childList: true, subtree: true });

/* ---------- HASH CHANGE LOGIC ---------- */
window.addEventListener("hashchange", () => {

  /* flashlight gate */
  if (path().includes("/cave/flashlight") && !inventory.includes("flashlight")) {
    location.hash = "#/home/outside/cave";
  }

  /* vault reward */
  if (path().endsWith("/vault/CORNY") && !inventory.includes("flashlight")) {
    inventory.push("flashlight");
  }

  /* SQL injection terminal */
  if (path().endsWith("/terminal")) {
    const input = prompt("username:");
    if (input && /('|--|OR 1=1)/i.test(input)) {
      location.hash = "#/admin";
    }
  }

  /* cookie puzzle */
  if (path() === "/admin") {
    if (document.cookie.includes("user=admin")) {
      location.hash = "#/end";
    }
  }

  render();
});

render();
</script>

</body>
</html>
