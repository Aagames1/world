<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Puzzle World</title>
<style>
:root {
  --bg: #000;
  --text: #16a34a;
  --muted: #065f46;
  --accent: #06b6d4;
}
html,body { height: 100%; }
body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
}
.container { max-width: 720px; width: 100%; }
.panel { border: 1px solid var(--text); padding: 20px; box-sizing: border-box; }
.title { color: var(--accent); margin-bottom: 12px; }
pre { white-space: pre-wrap; margin: 0 0 12px 0; }
.inventory { margin-top: 12px; color: #a7f3d0; font-size: 12px; }
</style>
</head>
<body>
<div id="root" class="container"></div>
<script>
(function(){
  const root = document.getElementById('root');
  let inventory = [];
  let rockHidden = false;
  let rockSeen = false;

  // Detect the GitHub Pages base path automatically
  const basePath = location.pathname.replace(/index\.html$/, '');
  const isFileProtocol = location.protocol === 'file:';

  // Use hash if file protocol, otherwise normalize path relative to basePath
  function getFullPath(){
    if(isFileProtocol) return location.hash.slice(1) || '/home';
    let path = location.pathname + location.search + location.hash;
    // strip basePath so /world/ becomes /
    if(basePath !== '/') path = path.replace(basePath, '/');
    return path || '/home';
  }

  function normalizePath(p){ if(!p.startsWith('/')) p='/' + p; return p; }

  const locations = {
    "/home": `You wake up in your home. Head /outside.`,
    "/home/outside": `To your left, a /farm, to your right, a /cave.`,
    "/home/outside/cave": `It’s very dark. You could try using a /flashlight.`,
    "/home/outside/farm": `You see a /hut and an open /field.`,
    "/flashlight": `You acquired /FLASHLIGHT. This could be useful somewhere else.`,
    "/cave/flashlight": `You turn on the flashlight. There’s a /wall, a /hole, and a /path.`,
    "/cave/flashlight/path": `You see a giant boulder. Hint: Inspect element (F12) → delete #blocking-rock to proceed.`,
    "/thewayforward": `The boulder has vanished. You may /continue.`,
    "/continue": `You continue forward and discover a /terminal requiring SQLi or cookie tricks.`,
    "/restart": `Game reset. Go to #/home to play again.`
  };

  function resolvePath(p){
    if(locations[p]) return {found:true, key:p, loc:locations[p]};
    return {found:false};
  }

  function navigateTo(newPath){
    newPath = normalizePath(newPath);
    if(isFileProtocol){ location.hash = newPath; }
    else{ history.replaceState({},'', basePath + newPath); }
    render();
  }

  function render(){
    const path = getFullPath();
    root.innerHTML = '';

    const header = document.createElement('div'); header.className='panel';
    const info = document.createElement('div'); info.style.color='#9ca3af'; info.style.marginBottom='8px';
    info.textContent='Change the browser address bar path (e.g. /home) and press Enter.';
    header.appendChild(info);

    const cur = document.createElement('div'); cur.textContent='Current path: ' + path; header.appendChild(cur);
    root.appendChild(header);

    const res = resolvePath(path);
    const notFound = !res.found;

    const main = document.createElement('div'); main.className='panel';
    if(notFound){ main.style.borderColor='#ff4444'; }

    const title = document.createElement('div'); title.className='title';
    title.textContent='> ' + (notFound ? '404' : res.key.split('/').filter(Boolean).pop() || 'Home');
    main.appendChild(title);

    const pre = document.createElement('pre');
    pre.textContent = notFound ? `Path not found: ${path}` : res.loc;
    if(notFound) pre.style.color='#ff4444';
    main.appendChild(pre);

    // Boulder puzzle
    if(path === '/cave/flashlight/path' && !rockHidden){
      const rock = document.createElement('pre');
      rock.id='blocking-rock';
      rock.textContent='■■■■■■■\n■■■■■■■\n■■■■■■■\n■■■■■■■\n■■■■■■■';
      rock.style.color='#66ffcc';
      main.appendChild(rock);
      rockSeen = true;
    } else if(path === '/cave/flashlight/path' && rockHidden){
      const gone = document.createElement('pre');
      gone.innerHTML='<strong style="color:#a3e635">THE BOULDER HAS VANISHED!</strong>\n\nThe boulder has vanished, revealing /thewayforward';
      main.appendChild(gone);
    }

    root.appendChild(main);
  }

  // Observe boulder removal
  new MutationObserver(()=>{ if(rockSeen && !document.getElementById('blocking-rock')) rockHidden=true; render(); }).observe(document.body,{childList:true,subtree:true});

  window.addEventListener(isFileProtocol ? 'hashchange' : 'popstate', render);
  render();
})();
</script>
</body>
</html>
