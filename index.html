<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Puzzle World</title>
<style>
  body {
    background: black;
    color: #00ffcc;
    font-family: monospace;
    padding: 20px;
    white-space: pre-wrap;
  }
</style>
</head>
<body>

<pre id="game"></pre>

<script>
/* ---------------- LOCATIONS ---------------- */
const locations = {
  "/start": `
PUZZLE WORLD

Welcome, traveler.

Modify the URL path to navigate.
Start by going to:

/home
  `,

  "/home": `
YOUR HOME

You wake up alone in your house.
The silence is unsettling.

Try:
/home/outside
  `,

  "/home/outside": `
OUTSIDE YOUR HOME

The world is eerily quiet.

Paths:
- /home/outside/farm
- /home/outside/cave
  `,

  "/home/outside/farm": `
THE FARM

Crops sway in the wind.

Paths:
- /home/outside/farm/hut
- /home/outside/farm/field
  `,

  "/home/outside/farm/hut": `
INSIDE THE HUT

Dust floats through beams of light.

Path:
/home/outside/farm/hut/vault
  `,

  "/home/outside/farm/hut/vault": `
THE VAULT

A digital lock awaits a 5-letter code.

Hint: Explore the field.
  `,

  "/home/outside/farm/field": `
THE FIELD

An abandoned tractor sits nearby.

Path:
/home/outside/farm/field/tractor
  `,

  "/home/outside/farm/field/tractor": `
THE TRACTOR

A note reads:

"What did the crop say?
Stop being CORNY!"
  `,

  "/home/outside/farm/hut/vault/CORNY": `
VAULT UNLOCKED

You obtained a FLASHLIGHT.

Proceed to:
/home/outside/cave
  `,

  "/home/outside/cave": `
CAVE ENTRANCE

It's pitch black inside.

You might need light.
  `,

  "/home/outside/cave/flashlight": `
CAVE (ILLUMINATED)

Your flashlight reveals stone walls.

Path:
/home/outside/cave/flashlight/path
  `,

  "/home/outside/cave/flashlight/path": `
THE NARROW PATH

A massive rock blocks the way.

Something about INSPECTING it...
  `,

  "/home/outside/cave/flashlight/path/beyond": `
BEYOND THE ROCK

A hidden facility appears ahead.

Path:
/home/outside/cave/flashlight/path/beyond/terminal
  `,

  "/home/outside/cave/flashlight/path/beyond/terminal": `
SECURITY TERMINAL

Username required.
(admin?)
  `,

  "/home/outside/cave/flashlight/path/beyond/terminal/lobby": `
TERMINAL LOBBY

You bypassed security.

A computer hums quietly.
  `,

  "/home/outside/cave/flashlight/path/beyond/terminal/mainframe": `
MAINFRAME ACCESS

Password required.
(Hint: HTML comments)
  `,

  "/home/outside/cave/flashlight/path/beyond/terminal/mainframe/ECHO42": `
MAINFRAME UNLOCKED

System access granted.

Paths:
- /files
- /settings
  `
};

/* ---------------- ROUTER ---------------- */

// Normalize /start/... to /home/...
function getPath() {
  let path = location.hash.replace("#", "") || "/start";

  // If URL starts with /start/home/..., normalize to /home/...
  if (path.startsWith("/start/")) {
    path = path.replace("/start", "");
    if (path === "") path = "/"; // just /start → /
  }

  return path;
}

// Longest-prefix match for deep navigation
function resolveLocation(path) {
  const parts = path.split("/").filter(Boolean);

  for (let i = parts.length; i >= 0; i--) {
    const candidate = "/" + parts.slice(0, i).join("/");
    if (locations[candidate]) {
      return {
        resolved: candidate,
        exact: candidate === path
      };
    }
  }
  return null;
}

function render() {
  const path = getPath();
  const game = document.getElementById("game");

  const match = resolveLocation(path);

  if (!match) {
    game.textContent = `
404 — PATH NOT FOUND

Entered:
${path}

No valid parent route exists.
    `;
    return;
  }

  game.textContent = `
CURRENT PATH:
${path}

--------------------------------

${locations[match.resolved]}

${match.exact ? "" : `
NOTE:
This path does not exist exactly.
Loaded nearest valid location:

${match.resolved}
`}
`;
}

// Listen for hash changes
window.addEventListener("hashchange", render);

// Initialize hash if empty
if (!location.hash) location.hash = "/start";

render();
</script>

</body>
</html>
