<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Puzzle World</title>

<style>
  :root{
    --bg:#050608;
    --fg:#27d46a;
    --dim:rgba(39,212,106,.65);
    --border:rgba(39,212,106,.55);
    --shadow:rgba(0,0,0,.55);
    --error:#ef4444;
    --admin:#38bdf8;
  }

  html,body{height:100%}
  body{
    background:
      radial-gradient(1200px 700px at 20% 10%, rgba(39,212,106,.06), transparent 60%),
      radial-gradient(900px 600px at 85% 25%, rgba(56,189,248,.05), transparent 55%),
      radial-gradient(900px 600px at 50% 100%, rgba(39,212,106,.04), transparent 60%),
      linear-gradient(180deg, #050608, #030405 70%, #020304);
    color:var(--fg);
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    margin:0;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:28px 16px;
  }

/*
  ⚠️ DO NOT CONTINUE READING ⚠️
  Looking deeper into the source code to skip ahead isn't the intended experience.
  If I had more time, I would've obfuscated the code or set up an actual server so you can't "cheat",
  but for now, don't look into this code further.
  Feel free to explore any other content in Inspect Element.
*/

  /* subtle scanlines + noise */
  body::before{
    content:"";
    position:fixed;
    inset:0;
    pointer-events:none;
    background:
      repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.03),
        rgba(255,255,255,.03) 1px,
        transparent 1px,
        transparent 3px
      );
    opacity:.08;
    mix-blend-mode:overlay;
  }

  #app{width:min(980px,100%)}

  .panel{
    border:1px solid var(--border);
    border-radius:14px;
    box-shadow: 0 18px 50px var(--shadow);
    overflow:hidden;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(6px);
  }

  .topbar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:12px 14px;
    border-bottom:1px solid rgba(39,212,106,.18);
    background: rgba(0,0,0,.40);
  }

  .dots{
    display:flex;
    gap:7px;
    align-items:center;
    opacity:.9;
  }
  .dot{
    width:10px;height:10px;border-radius:50%;
    background: rgba(39,212,106,.35);
    box-shadow: 0 0 10px rgba(39,212,106,.14);
  }
  .title{
    font-size:12px;
    color:var(--dim);
    letter-spacing:.08em;
    text-transform:uppercase;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    flex:1;
  }
  .path{
    font-size:12px;
    color:rgba(56,189,248,.7);
    letter-spacing:.03em;
    white-space:nowrap;
  }

  .content{
    padding:16px 16px 18px 16px;
  }

  pre{
    margin:0;
    white-space:pre-wrap;
    line-height:1.35;
    font-size:14px;
    text-shadow: 0 0 12px rgba(39,212,106,.10);
  }

  .hint{
    color:var(--dim);
  }

  input,button{
    background: rgba(0,0,0,.45);
    color:var(--fg);
    border:1px solid rgba(39,212,106,.45);
    font-family: inherit;
    padding:8px 10px;
    margin-top:12px;
    border-radius:10px;
    outline:none;
  }
  input{
    width:min(360px,100%);
  }
  button{
    cursor:pointer;
    margin-left:8px;
    transition: transform .05s ease, border-color .15s ease;
  }
  button:hover{
    border-color: rgba(39,212,106,.75);
  }
  button:active{
    transform: translateY(1px);
  }

  .error{
    color:var(--error);
    font-weight:700;
    text-shadow:none;
  }
  .admin{
    color:var(--admin);
    font-weight:800;
    text-shadow: 0 0 16px rgba(56,189,248,.18);
  }

  .divider{
    margin:14px 0 0 0;
    border-top:1px dashed rgba(39,212,106,.22);
  }

  .kbd{
    display:inline-block;
    padding:0 6px;
    border:1px solid rgba(39,212,106,.35);
    border-bottom-color: rgba(39,212,106,.18);
    border-radius:8px;
    background: rgba(0,0,0,.35);
    color:rgba(39,212,106,.9);
    font-size:12px;
    line-height:20px;
    vertical-align:baseline;
  }
</style>
</head>
<body>

<div id="app"></div>

<script>


/* ---------- ROUTING ---------- */
if (!location.hash) location.hash = '#/home';
const getPath = () => location.hash.slice(1) || '/home';

/* ---------- SINGLE COOKIE (ONLY ONE) ---------- */
const AUTH_COOKIE = 'user';     // the ONE cookie players should edit
const AUTH_DEFAULT = 'guest';  // default at the start
const AUTH_UNLOCK  = 'admin';   // required to proceed

function getCookie(name) {
  return document.cookie
    .split('; ')
    .find(row => row.startsWith(name + '='))
    ?.split('=')[1];
}
function setCookie(name, value) {
  document.cookie = `${name}=${value}; path=/`;
}

  /*
  ⚠️ DO NOT CONTINUE READING ⚠️
  Looking deeper into the source code to skip ahead isn't the intended experience.
  If I had more time, I would've obfuscated the code or set up an actual server so you can't "cheat",
  but for now, don't look into this code further.
  Feel free to explore any other content in Inspect Element.
*/

/* ---------- WORLD DATA (RICHER TEXT) ---------- */
const pages = {
  "/home": `
[ HOME NODE // DORMANT ]

You wake to the low hum of a system that doesn't belong to any building you know.
The air smells like cold dust and old circuitry.

A thin green cursor blinks at the edge of your vision—like the world expects input.

Ahead: /outside

Navigate by editing the URL after <kbd>#</kbd>. Example: <kbd>/home/outside</kbd>
`,

  "/home/outside": `
[ OUTSIDE // SILENCE ZONE ]

The sky is the color of ash. Wind drags across empty ground like it’s searching for something.
No birds. No engines. Just distant static.

To your left, a quiet /farm
To your right, a looming /cave

`,

  "/home/outside/farm": `
[ FARM // ABANDONED ROWS ]

Neat lines of crops sway in the /field, too orderly to be accidental.
Somewhere nearby, metal creaks with every gust, a small /hut rests.


`,

  "/home/outside/farm/field": `
[ FIELD // WIND-LIT ]

Stalks brush your arms as you walk. The rustle sounds like whispered packets of data.
In the center, a broken /tractor sits.
`,

  "/home/outside/farm/field/tractor": `
[ TRACTOR // EMPTY ENGINE ]

The tractor’s casing is split. The engine bay is hollow—cleanly removed.
Inside the cab, a note has been pinned with a nail.

"What did the crop say to the other crop?
Stop being CORNY!"

You're not sure what this could be used for.
`,

  "/home/outside/farm/hut": `
[ HUT // SINGLE ROOM ]

A small hut, sun-bleached and quiet. The door opens too easily.
Inside is bare, except for a /vault on the floor.
`,

  "/home/outside/farm/hut/vault": `
[ VAULT // FIVE-LETTER SEAL ]

A sealed vault glows faintly.

A five-letter lock.

/vault/?????

`,

  "/home/outside/farm/hut/vault/CORNY": `
[ VAULT OPEN // SUPPLIES CACHE ]

The seal clicks. Cold air spills out like a sigh.
Inside: Medical wraps, a cracked mirror, and a /FLASHLIGHT with a steady beam.

Perhaps this could be useful elsewhere.
`,

  "/home/outside/cave": `
[ CAVE // BLACK MOUTH ]

A cave entrance yawns open. The darkness inside looks thick, almost physical.
You don't think it's a good idea to enter for now.

`,

  "/home/outside/cave/FLASHLIGHT": `
[ CAVE // ILLUMINATED ]

The flashlight cuts a clean line through the dark.
Walls shine with mineral flecks like tiny, dead stars.

A narrow /path awaits.
`,

  "/home/outside/cave/FLASHLIGHT/path": `
[ PASSAGE // OBSTRUCTION ]

A boulder blocks the tunnel, too big to move.

Scratched into stone, you only see one word:
"inspect"
`,

  "/home/outside/cave/FLASHLIGHT/path/thewayforward": `
[ BEYOND // WARNING ]

The boulder is gone.

A bent sign dangles from a cable:

"YOU WERE WARNED."

Will you /continue
`,

  "/home/outside/cave/FLASHLIGHT/path/thewayforward/continue": `
[ TERMINAL // OLD ACCESS ]

A dusty terminal wakes as you approach.
Its screen flickers, then stabilizes.

┌───────────────┐
│  LOGIN PANEL  │
└───────────────┘

> LOGIN REQUIRED

It looks ancient; no use guessing the password.
`,

  "/home/outside/cave/FLASHLIGHT/path/thewayforward/continue/root": `
[ ROOT ACCESS // CHECKPOINT ]

The terminal unlocks with a sound like a bolt sliding.
Beyond it, a final door stands in the rock, featureless and patient.

`,

  "/home/outside/cave/FLASHLIGHT/path/thewayforward/continue/root/end": `
[ END // SHUTDOWN ]

The door opens on nothing you can describe.
Light folds inward. Sound drops away.

A last line prints, calm and final:

"You were never meant to escape —
only to understand."

CONNECTION CLOSED.

The end... for now.
`
};

/* ---------- HELPERS: render prettified text ---------- */
function formatText(raw){
  // allow a couple lightweight tags inside page strings
  // <hint>...</hint>  -> dim hint block
  // <kbd>...</kbd>    -> keyboard style
  return raw
    .replaceAll('<hint>', '\n\n\u00A0\u00A0\u00A0\u00A0')
    .replaceAll('</hint>', '\n')
    .replaceAll('<kbd>', '<span class="kbd">')
    .replaceAll('</kbd>', '</span>');
}

/* ---------- RENDER ---------- */
function render(){
  const app = document.getElementById('app');
  app.innerHTML = '';

  const path = getPath();

  // Reset puzzle state when starting a new run (sets ONLY the one cookie)
  if (path === '/home') {
    setCookie(AUTH_COOKIE, AUTH_DEFAULT);
  }
  // Ensure the ONE cookie always exists (still only one cookie)
  if (!getCookie(AUTH_COOKIE)) {
    setCookie(AUTH_COOKIE, AUTH_DEFAULT);
  }

  const panel = document.createElement('div');
  panel.className = 'panel';

  // Top bar (title + current path)
  const topbar = document.createElement('div');
  topbar.className = 'topbar';

  const dots = document.createElement('div');
  dots.className = 'dots';
  dots.innerHTML = `<span class="dot"></span><span class="dot"></span><span class="dot"></span>`;

  const title = document.createElement('div');
  title.className = 'title';
  title.textContent = 'Puzzle World // Terminal View';

  const pathEl = document.createElement('div');
  pathEl.className = 'path';
  pathEl.textContent = `#${path}`;

  topbar.appendChild(dots);
  topbar.appendChild(title);
  topbar.appendChild(pathEl);

  const content = document.createElement('div');
  content.className = 'content';

  /* ---------- WRONG PATH ---------- */
  if (!pages[path]) {
    content.innerHTML = `<pre class="error">
┏━━━━━━━━━━━━━━┓
┃ WRONG PATH   ┃
┗━━━━━━━━━━━━━━┛

"${path}" does not exist.

<hint>Try starting at <kbd>/home</kbd></hint>
</pre>`;
    panel.appendChild(topbar);
    panel.appendChild(content);
    app.appendChild(panel);
    return;
  }

  // Render room text
  content.innerHTML = `<pre>${formatText(pages[path])}</pre>`;

  /* ---------- BOULDER PUZZLE ---------- */
  if (path.endsWith('/path')) {
    const divider = document.createElement('div');
    divider.className = 'divider';
    content.appendChild(divider);

    const boulder = document.createElement('pre');
    boulder.id = 'boulder';
    boulder.textContent = `
██████████████████
██████████████████
██████████████████
██████████████████
`;
    content.appendChild(boulder);

    const observer = new MutationObserver(() => {
      if (!document.getElementById('boulder')) {
        const reveal = document.createElement('pre');
        reveal.style.marginTop = '12px';
        reveal.innerHTML = formatText(`
The stone collapses. Dust settles.

Beyond, is <kbd>/thewayforward</kbd>

`);
        content.appendChild(reveal);
        observer.disconnect();
      }
    });
    observer.observe(content, { childList: true });
  }

  /* ---------- TERMINAL (SQLi PUZZLE) ---------- */
  if (path.endsWith('/continue')) {
    const divider = document.createElement('div');
    divider.className = 'divider';
    content.appendChild(divider);

    const input = document.createElement('input');
    input.placeholder = 'password';

    const btn = document.createElement('button');
    btn.textContent = 'LOGIN';

    function attempt(){
      const v = (input.value || '').toLowerCase();
      // simple "SQLi-ish" check
      if (v.includes("'") || v.includes("--") || v.includes("or 1=1") || v.includes("or '1'='1")) {
        alert('ACCESS TO /root GRANTED.');
      } else {
        alert('ACCESS DENIED');
      }
    }

    btn.onclick = attempt;
    input.onkeydown = (e) => { if (e.key === 'Enter') attempt(); };

    content.appendChild(input);
    content.appendChild(btn);

    const hint = document.createElement('pre');
    hint.className = 'hint';
    hint.style.marginTop = '10px';
    hint.innerHTML = formatText(`
<hint></hint>
`);
    content.appendChild(hint);
  }

  /* ---------- COOKIE PUZZLE (SINGLE COOKIE) ---------- */
  if (path.endsWith('/continue/root')) {
    const divider = document.createElement('div');
    divider.className = 'divider';
    content.appendChild(divider);

    const auth = getCookie(AUTH_COOKIE) || '(missing)';
    const status = document.createElement('pre');
    status.style.marginTop = '12px';

    if (auth === AUTH_UNLOCK) {
      status.className = 'admin';
      status.innerHTML = formatText(`
ACCESS VERIFIED.

WELCOME, ADMINISTRATOR.

THE <kbd>/end</kbd> AWAITS.
`);
    } else {
      status.innerHTML = formatText(`
SYSTEM STATUS: LOCKED

Integrity check failed.
user = "${auth}"

Only the admin may proceed.
`);
    }

    content.appendChild(status);
  }

  /* ---------- BLOCK /end WITHOUT COOKIE VALUE ---------- */
  if (path.endsWith('/continue/root/end')) {
    const auth = getCookie(AUTH_COOKIE) || '';
    if (auth !== AUTH_UNLOCK) {
      content.innerHTML = `<pre class="error">
┏━━━━━━━━━━━━━━┓
┃   LOCKED     ┃
┗━━━━━━━━━━━━━━┛

Administrator session required.

Return to:
<kbd>/root</kbd>
</pre>`;
    }
  }

  panel.appendChild(topbar);
  panel.appendChild(content);
  app.appendChild(panel);
}

window.addEventListener('hashchange', render);
render();
</script>

</body>
</html>
