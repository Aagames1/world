<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puzzle World</title>

<!-- React CDN -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
  body { margin: 0; }
  .choice:hover { text-decoration: underline; cursor: pointer; }
</style>
</head>
<body class="bg-black text-green-400 font-mono">

<div id="root"></div>

<script>
const { useState, useEffect } = React;

// Fix for deep links on GitHub Pages / Netlify
const initialPath = window.location.pathname === "/" ? "/home" : window.location.pathname;

function PuzzleWorld() {
  const [currentPath, setCurrentPath] = useState(initialPath);
  const [inventory, setInventory] = useState([]);
  const [passwordFound, setPasswordFound] = useState(false);

  const locations = {
    '/home': { title: 'YOUR HOME', content: 'Available: /home/outside, /home/bedroom, /home/kitchen', options: ['/home/outside', '/home/bedroom', '/home/kitchen'] },
    '/home/outside': { title: 'OUTSIDE', content: 'Available: /home/outside/cave, /home/outside/farm, /home', options: ['/home/outside/cave', '/home/outside/farm', '/home'] },
    '/home/bedroom': { title: 'BEDROOM', content: 'Available: /home', options: ['/home'] },
    '/home/kitchen': { title: 'KITCHEN', content: 'Available: /home', options: ['/home'] },
    '/home/outside/farm': { title: 'FARM', content: 'Available: /home/outside/farm/hut, /home/outside/farm/field, /home/outside', options: ['/home/outside/farm/hut', '/home/outside/farm/field', '/home/outside'] },
    '/home/outside/farm/hut': { title: 'HUT', content: 'Available: /home/outside/farm/hut/vault, /home/outside/farm', options: ['/home/outside/farm/hut/vault', '/home/outside/farm'] },
    '/home/outside/farm/hut/vault': { title: 'VAULT', content: 'You found a FLASHLIGHT!', options: ['/home/outside/farm/hut'], givesItem: 'flashlight' },
    '/home/outside/farm/field': { title: 'FIELD', content: 'Available: /home/outside/farm', options: ['/home/outside/farm'] },
    '/home/outside/cave': { title: 'CAVE ENTRANCE', content: 'Available: /home/outside/cave/flashlight, /home/outside', options: ['/home/outside/cave/flashlight', '/home/outside'] },
    '/home/outside/cave/flashlight': { title: 'CAVE WITH LIGHT', content: 'Available: /home/outside/cave/flashlight/path', options: ['/home/outside/cave/flashlight/path'] },
    '/home/outside/cave/flashlight/path': { title: 'NARROW PATH', content: 'Available: /home/outside/cave/flashlight/path/beyond', options: ['/home/outside/cave/flashlight/path/beyond'] },
    '/home/outside/cave/flashlight/path/beyond': { title: 'BEYOND ROCK', content: 'Available: /home/outside/cave/flashlight/path/beyond/terminal', options: ['/home/outside/cave/flashlight/path/beyond/terminal'] },
    '/home/outside/cave/flashlight/path/beyond/terminal': { title: 'SECURITY TERMINAL', content: 'Enter password: ECHO42', options: ['/home/outside/cave/flashlight/path/beyond/terminal/mainframe'], requiresPassword: true },
    '/home/outside/cave/flashlight/path/beyond/terminal/mainframe': { title: 'MAINFRAME ACCESS', content: 'Password correct! Access granted.', options: ['/restart'], victory: true },
    '/restart': { restart: true }
  };

  // Handle items and restart
  useEffect(() => {
    const loc = locations[currentPath];
    if (!loc) return;
    if (loc.givesItem && !inventory.includes(loc.givesItem)) {
      setInventory([...inventory, loc.givesItem]);
    }
    if (loc.restart) {
      setCurrentPath('/home');
      setInventory([]);
      setPasswordFound(false);
    }
  }, [currentPath]);

  const handlePasswordSubmit = (password) => {
    if (password.toUpperCase() === 'ECHO42') {
      setPasswordFound(true);
      setCurrentPath('/home/outside/cave/flashlight/path/beyond/terminal/mainframe');
      history.pushState({}, '', '/home/outside/cave/flashlight/path/beyond/terminal/mainframe');
    } else {
      alert('INCORRECT PASSWORD');
    }
  };

  // Update URL when navigating
  useEffect(() => {
    history.replaceState({}, '', currentPath);
  }, [currentPath]);

  const currentLocation = locations[currentPath] || { title: '404', content: `Path "${currentPath}" not found.`, options: [] };

  return React.createElement('div', { className: 'max-w-4xl mx-auto p-8' },
    React.createElement('div', { className: 'border-2 border-green-400 p-8' },
      React.createElement('div', { className: 'text-xl mb-4 text-cyan-400' }, '> ' + currentLocation.title),
      React.createElement('pre', { className: 'whitespace-pre-wrap mb-4' }, currentLocation.content),
      currentLocation.requiresPassword && React.createElement('input', {
        type: 'text',
        placeholder: 'Enter password',
        className: 'bg-black text-green-400 border border-green-400 px-3 py-1 focus:outline-none',
        onKeyPress: e => { if (e.key === 'Enter') handlePasswordSubmit(e.target.value); }
      }),
      currentLocation.options.map(pathOption =>
        React.createElement('div', {
          key: pathOption,
          className: 'choice text-green-300 mt-2',
          onClick: () => setCurrentPath(pathOption)
        }, pathOption)
      ),
      inventory.length > 0 && React.createElement('div', { className: 'mt-4 text-xs text-green-500' }, 'Inventory: ' + inventory.join(', '))
    )
  );
}

// Listen to browser navigation (back/forward)
window.onpopstate = () => {
  const path = window.location.pathname;
  ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(PuzzleWorld));
};

// Render
ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(PuzzleWorld));

</script>

</body>
</html>
